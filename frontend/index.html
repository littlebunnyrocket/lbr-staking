<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Little Bunny Rocket Staking</title>
    <link rel="icon" href="https://littlebunnyrocket.com/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --dark-blue: #0a1a2e;
            --medium-blue: #1a2a4a;
            --light-blue: #4a90e2;
            --accent-blue: #00b4d8;
            --text-light: #e6f1ff;
            --text-muted: #8892b0;
        }
        
        body {
            background: url('https://littlebunnyrocket.com/bg.jpg') no-repeat center center fixed;
            background-size: cover;
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(10, 26, 46, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(74, 144, 226, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.36);
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            border: 1px solid rgba(74, 144, 226, 0.4);
            box-shadow: 0 8px 32px 0 rgba(0, 180, 216, 0.2);
        }
        
        .card-title {
            color: var(--accent-blue);
            border-bottom: 1px solid rgba(74, 144, 226, 0.3);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .btn-primary {
            background-color: var(--light-blue);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background-color: var(--accent-blue);
            transform: translateY(-2px);
        }
        
        .btn-outline-primary {
            color: var(--light-blue);
            border-color: var(--light-blue);
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-outline-primary:hover {
            background-color: var(--light-blue);
            color: var(--dark-blue);
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background-color: #e63946;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-danger:hover {
            background-color: #ff4d6d;
            transform: translateY(-2px);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-blue);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .wallet-address {
            background: rgba(26, 42, 74, 0.6);
            border-radius: 20px;
            padding: 5px 15px;
            font-family: monospace;
            cursor: pointer;
            transition: all 0.3s ease;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: inline-block;
        }
        
        .wallet-address:hover {
            background: rgba(26, 42, 74, 0.9);
        }
        
        .form-control {
            background-color: rgba(10, 26, 46, 0.7);
            border: 1px solid rgba(74, 144, 226, 0.3);
            color: var(--text-light);
            border-radius: 8px;
        }
        
        .form-control:focus {
            background-color: rgba(10, 26, 46, 0.9);
            border: 1px solid var(--light-blue);
            color: var(--text-light);
            box-shadow: 0 0 0 0.25rem rgba(74, 144, 226, 0.25);
        }
        
        .nav-tabs {
            border-bottom: 1px solid rgba(74, 144, 226, 0.3);
        }
        
        .nav-tabs .nav-link {
            color: var(--text-muted);
            border: none;
            padding: 10px 20px;
            font-weight: 600;
        }
        
        .nav-tabs .nav-link.active {
            color: var(--accent-blue);
            background: transparent;
            border-bottom: 2px solid var(--accent-blue);
        }
        
        .nav-tabs .nav-link:hover {
            color: var(--text-light);
            border-color: transparent;
        }
        
        .tab-content {
            padding: 20px 0;
        }
        
        .token-icon {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }
        
        @media (max-width: 768px) {
            .stat-value {
                font-size: 1.5rem;
            }
            
            .glass-card {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <!-- Header -->
        <header class="d-flex justify-content-between align-items-center mb-4">
            <div class="d-flex align-items-center">
                <img src="https://littlebunnyrocket.com/favicon.ico" alt="LBR Logo" class="token-icon">
                <h1 class="mb-0">Little Bunny Rocket Staking</h1>
            </div>
            <div id="wallet-section">
                <button id="connect-wallet" class="btn btn-primary">
                    <i class="fas fa-wallet me-2"></i>Connect Wallet
                </button>
                <div id="wallet-connected" class="d-none align-items-center">
                    <span id="wallet-address" class="wallet-address me-2"></span>
                    <button id="disconnect-wallet" class="btn btn-sm btn-danger">
                        <i class="fas fa-power-off"></i>
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Network Info -->
        <div class="glass-card mb-4">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <span class="badge bg-primary">Network: Rise ETH Testnet</span>
                    <span class="badge bg-secondary ms-2">Chain ID: 11155931</span>
                </div>
                <div>
                    <a href="https://explorer.testnet.riselabs.xyz" target="_blank" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-external-link-alt me-1"></i>Explorer
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="row">
            <!-- Overview Section -->
            <div class="col-lg-12">
                <div class="glass-card">
                    <h4 class="card-title"><i class="fas fa-chart-line me-2"></i>Overview</h4>
                    <div class="row text-center">
                        <div class="col-md-3 col-6 mb-3">
                            <div class="stat-value" id="total-staked">0</div>
                            <div class="stat-label">Total Staked</div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="stat-value" id="your-stake">0</div>
                            <div class="stat-label">Your Stake</div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="stat-value" id="your-rewards">0</div>
                            <div class="stat-label">Your Rewards</div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="stat-value" id="treasury-balance">0</div>
                            <div class="stat-label">Treasury Balance</div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-6 mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="stat-label">Staking Reward Rate</span>
                                <span class="stat-value" id="staking-reward-rate">0</span>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="stat-label">Burn Reward Rate</span>
                                <span class="stat-value" id="burn-reward-rate">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Deposit/Withdraw Section -->
            <div class="col-lg-6">
                <div class="glass-card">
                    <h4 class="card-title"><i class="fas fa-exchange-alt me-2"></i>lbrETH ↔ ETH</h4>
                    <ul class="nav nav-tabs" id="depositWithdrawTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="deposit-tab" data-bs-toggle="tab" data-bs-target="#deposit" type="button" role="tab">Deposit</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="withdraw-tab" data-bs-toggle="tab" data-bs-target="#withdraw" type="button" role="tab">Withdraw</button>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="deposit" role="tabpanel">
                            <div class="mb-3">
                                <label for="deposit-amount" class="form-label">ETH Amount</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="deposit-amount" placeholder="0.0">
                                    <button class="btn btn-outline-primary" id="max-deposit">MAX</button>
                                </div>
                            </div>
                            <button class="btn btn-primary w-100" id="deposit-eth">
                                <i class="fas fa-arrow-down me-2"></i>Deposit ETH to lbrETH
                            </button>
                        </div>
                        <div class="tab-pane fade" id="withdraw" role="tabpanel">
                            <div class="mb-3">
                                <label for="withdraw-amount" class="form-label">lbrETH Amount</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="withdraw-amount" placeholder="0.0">
                                    <button class="btn btn-outline-primary" id="max-withdraw">MAX</button>
                                </div>
                            </div>
                            <button class="btn btn-primary w-100" id="withdraw-lbreth">
                                <i class="fas fa-arrow-up me-2"></i>Withdraw lbrETH to ETH
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Stake Dashboard -->
            <div class="col-lg-6">
                <div class="glass-card">
                    <h4 class="card-title"><i class="fas fa-coins me-2"></i>Stake Dashboard</h4>
                    <div class="mb-3">
                        <label for="stake-amount" class="form-label">lbrETH Amount</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="stake-amount" placeholder="0.0">
                            <button class="btn btn-outline-primary" id="max-stake">MAX</button>
                        </div>
                    </div>
                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-primary flex-grow-1" id="approve-stake">
                            <i class="fas fa-check-circle me-2"></i>Approve
                        </button>
                        <button class="btn btn-primary flex-grow-1" id="stake">
                            <i class="fas fa-lock me-2"></i>Stake
                        </button>
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary flex-grow-1" id="unstake">
                            <i class="fas fa-unlock me-2"></i>Unstake
                        </button>
                        <button class="btn btn-outline-primary flex-grow-1" id="claim-rewards">
                            <i class="fas fa-gift me-2"></i>Claim Rewards
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Burn for Reward -->
            <div class="col-lg-6">
                <div class="glass-card">
                    <h4 class="card-title"><i class="fas fa-fire me-2"></i>Burn for Reward</h4>
                    <div class="alert alert-info bg-transparent border-info mb-3 text-white">
                        <small>Burn Reward Rate: 110% of Total Burn with daily burn limit 0.05% of total supply</small>
                    </div>
                    <div class="mb-3">
                        <label for="burn-amount" class="form-label">LBR Amount</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="burn-amount" placeholder="0.0">
                            <button class="btn btn-outline-primary" id="max-burn">MAX</button>
                        </div>
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-primary flex-grow-1" id="approve-burn">
                            <i class="fas fa-check-circle me-2"></i>Approve
                        </button>
                        <button class="btn btn-danger flex-grow-1" id="burn">
                            <i class="fas fa-fire me-2"></i>Burn
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Lock Reward -->
            <div class="col-lg-6">
                <div class="glass-card">
                    <h4 class="card-title"><i class="fas fa-clock me-2"></i>Lock Reward</h4>
                    <div class="mb-3">
                        <label for="lock-amount" class="form-label">LBR Amount</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="lock-amount" placeholder="0.0">
                            <button class="btn btn-outline-primary" id="max-lock">MAX</button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="lock-duration" class="form-label">Duration (days)</label>
                        <select class="form-select" id="lock-duration">
                            <option value="30">30 days</option>
                            <option value="60">60 days</option>
                            <option value="90">90 days</option>
                            <option value="180">180 days</option>
                            <option value="365">365 days</option>
                        </select>
                    </div>
                    <div class="d-flex gap-2 mb-3">
                        <button class="btn btn-primary flex-grow-1" id="approve-lock">
                            <i class="fas fa-check-circle me-2"></i>Approve
                        </button>
                        <button class="btn btn-primary flex-grow-1" id="lock">
                            <i class="fas fa-clock me-2"></i>Lock
                        </button>
                    </div>
                    <div id="active-locks" class="mt-3">
                        <h6 class="text-center mb-3">Your Active Locks</h6>
                        <div id="locks-list" class="text-center">
                            <p class="text-muted">No active locks found</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- LBR Token Overview -->
            <div class="col-lg-12">
                <div class="glass-card">
                    <h4 class="card-title"><i class="fas fa-info-circle me-2"></i>LBR Token Overview</h4>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-wallet me-3 fs-4 text-primary"></i>
                                <div>
                                    <div class="stat-label">Your LBR Balance</div>
                                    <div class="stat-value" id="lbr-balance">0</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-coins me-3 fs-4 text-primary"></i>
                                <div>
                                    <div class="stat-label">Total Supply</div>
                                    <div class="stat-value" id="total-supply">0</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-fire me-3 fs-4 text-primary"></i>
                                <div>
                                    <div class="stat-label">Burned Today</div>
                                    <div class="stat-value" id="burned-today">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-primary bg-transparent border-primary text-white">
                        <small>LBR is earned through staking. Diamond hand it, and maybe — just maybe — you'll thank yourself. Or not.</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction Modal -->
    <div class="modal fade" id="transactionModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content glass-card">
                <div class="modal-header border-0">
                    <h5 class="modal-title" id="transactionModalTitle">Transaction in Progress</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center py-4">
                    <div id="tx-loading" class="mb-3">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3 mb-0" id="tx-message">Waiting for transaction confirmation...</p>
                    </div>
                    <div id="tx-success" class="d-none">
                        <i class="fas fa-check-circle text-success mb-3" style="font-size: 3rem;"></i>
                        <p class="mb-0">Transaction successful!</p>
                        <a href="#" id="tx-explorer-link" target="_blank" class="btn btn-sm btn-outline-primary mt-3">View on Explorer</a>
                    </div>
                    <div id="tx-error" class="d-none">
                        <i class="fas fa-times-circle text-danger mb-3" style="font-size: 3rem;"></i>
                        <p class="mb-0" id="tx-error-message">Transaction failed</p>
                        <button class="btn btn-sm btn-outline-primary mt-3" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script>
        // Contract Addresses
        const lbrETHAddress = "0x562E6B7884Cb0b9876D1D51BF1Be990Cf43FF55B";
        const lbrTokenAddress = "0x7E82da3Bd232eb1EAcFd6427060fb427461d0132";
        const lbrTreasuryAddress = "0xD3147D0edB453d8777FdE63CBB408D9477e1Eb85";
        const lbrStakingAddress = "0xA2C2498D490C77a2707F663a6cfd87825204b617";
        
        // Contract ABIs
        const lbrETHABI = [
            {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"deposit","outputs":[],"stateMutability":"payable","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"}
        ];
        
        const lbrTokenABI = [
            {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"burn","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"burnFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
        ];
        
        const lbrStakingABI = [
            {"inputs":[],"name":"totalStaked","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"stakes","outputs":[{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"rewardPerTokenStored","type":"uint256"},{"internalType":"uint256","name":"lastClaimed","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"earned","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"stakingRewardRate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"burnRewardRate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"getTreasuryLBRBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"stake","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"unstake","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"claimReward","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"burnForReward","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"duration","type":"uint256"}],"name":"lockReward","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"lockId","type":"uint256"}],"name":"unlock","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserLocks","outputs":[{"components":[{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"unlockTime","type":"uint256"},{"internalType":"uint256","name":"apy","type":"uint256"},{"internalType":"bool","name":"claimed","type":"bool"}],"internalType":"struct LBRStaking.LockInfo[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"}
        ];
        
        const lbrTreasuryABI = [
          {
            "inputs": [
              {
                "internalType": "address",
                "name": "_lbrToken",
                "type": "address"
              },
              {
                "internalType": "address",
                "name": "initialOwner",
                "type": "address"
              }
            ],
            "stateMutability": "nonpayable",
            "type": "constructor"
          },
          {
            "inputs": [],
            "name": "burnedToday",
            "outputs": [
              {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
              }
            ],
            "stateMutability": "view",
            "type": "function"
          },
          {
            "inputs": [],
            "name": "lastBurnDate",
            "outputs": [
              {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
              }
            ],
            "stateMutability": "view",
            "type": "function"
          },
          {
            "inputs": [],
            "name": "LBR",
            "outputs": [
              {
                "internalType": "contract ILBRToken",
                "name": "",
                "type": "address"
              }
            ],
            "stateMutability": "view",
            "type": "function"
          },
          {
            "inputs": [],
            "name": "stakingContract",
            "outputs": [
              {
                "internalType": "address",
                "name": "",
                "type": "address"
              }
            ],
            "stateMutability": "view",
            "type": "function"
          },
          {
            "inputs": [
              {
                "internalType": "uint256",
                "name": "amount",
                "type": "uint256"
              }
            ],
            "name": "burn",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
          },
          {
            "inputs": [
              {
                "internalType": "uint256",
                "name": "amount",
                "type": "uint256"
              }
            ],
            "name": "deposit",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
          },
          {
            "inputs": [
              {
                "internalType": "address",
                "name": "to",
                "type": "address"
              },
              {
                "internalType": "uint256",
                "name": "amount",
                "type": "uint256"
              }
            ],
            "name": "distribute",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
          },
          {
            "inputs": [
              {
                "internalType": "address",
                "name": "_stakingContract",
                "type": "address"
              }
            ],
            "name": "setStakingContract",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
          }
        ];

        
        // Global variables
        let provider;
        let signer;
        let userAddress;
        let lbrETHContract;
        let lbrTokenContract;
        let lbrStakingContract;
        let lbrTreasuryContract;
        
        // DOM Elements
        const connectWalletBtn = document.getElementById('connect-wallet');
        const walletConnectedDiv = document.getElementById('wallet-connected');
        const walletAddressSpan = document.getElementById('wallet-address');
        const disconnectWalletBtn = document.getElementById('disconnect-wallet');
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize Web3
            if (window.ethereum) {
                try {
                    // Request account access
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    initWeb3();
                } catch (error) {
                    console.error("User denied account access");
                }
            } else {
                console.log("MetaMask or other Web3 provider not detected");
                // You can show a message to the user to install MetaMask
            }
            
            // Set up event listeners
            setupEventListeners();
        });
        
        // Initialize Web3
        async function initWeb3() {
            try {
                // Check if MetaMask is installed
                if (window.ethereum) {
                    web3 = new Web3(window.ethereum);
                    
                    // Set up ethers.js provider and signer
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    signer = provider.getSigner();
                    
                    // Get user address
                    const accounts = await web3.eth.getAccounts();
                    userAddress = accounts[0];
                    
                    // Initialize contracts
                    lbrETHContract = new web3.eth.Contract(lbrETHABI, lbrETHAddress);
                    lbrTokenContract = new web3.eth.Contract(lbrTokenABI, lbrTokenAddress);
                    lbrStakingContract = new web3.eth.Contract(lbrStakingABI, lbrStakingAddress);
                    lbrTreasuryContract = new web3.eth.Contract(lbrTreasuryABI, lbrTreasuryAddress);
                    
                    // Update UI
                    updateWalletUI();
                    updateStats();
                    
                    // Set up event listeners for account and chain changes
                    window.ethereum.on('accountsChanged', (accounts) => {
                        if (accounts.length === 0) {
                            // MetaMask is locked or user has disconnected all accounts
                            disconnectWallet();
                        } else {
                            userAddress = accounts[0];
                            updateWalletUI();
                            updateStats();
                        }
                    });
                    
                    window.ethereum.on('chainChanged', () => {
                        window.location.reload();
                    });
                } else {
                    console.log("Please install MetaMask!");
                }
            } catch (error) {
                console.error("Error initializing Web3:", error);
            }
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Wallet connection
            connectWalletBtn.addEventListener('click', connectWallet);
            disconnectWalletBtn.addEventListener('click', disconnectWallet);
            
            // Deposit/Withdraw
            document.getElementById('deposit-eth').addEventListener('click', depositETH);
            document.getElementById('withdraw-lbreth').addEventListener('click', withdrawLbrETH);
            document.getElementById('max-deposit').addEventListener('click', setMaxDeposit);
            document.getElementById('max-withdraw').addEventListener('click', setMaxWithdraw);
            
            // Stake Dashboard
            document.getElementById('stake').addEventListener('click', stakeLbrETH);
            document.getElementById('unstake').addEventListener('click', unstakeLbrETH);
            document.getElementById('claim-rewards').addEventListener('click', claimRewards);
            document.getElementById('approve-stake').addEventListener('click', approveStake);
            document.getElementById('max-stake').addEventListener('click', setMaxStake);
            
            // Burn for Reward
            document.getElementById('burn').addEventListener('click', burnForReward);
            document.getElementById('approve-burn').addEventListener('click', approveBurn);
            document.getElementById('max-burn').addEventListener('click', setMaxBurn);
            
            // Lock Reward
            document.getElementById('lock').addEventListener('click', lockReward);
            document.getElementById('approve-lock').addEventListener('click', approveLock);
            document.getElementById('max-lock').addEventListener('click', setMaxLock);
        }
        
        // Connect wallet
        async function connectWallet() {
            try {
                if (window.ethereum) {
                    // Request account access
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    initWeb3();
                } else {
                    alert("Please install MetaMask or another Web3 provider!");
                }
            } catch (error) {
                console.error("Error connecting wallet:", error);
            }
        }
        
        // Disconnect wallet
        function disconnectWallet() {
            userAddress = null;
            connectWalletBtn.classList.remove('d-none');
            walletConnectedDiv.classList.add('d-none');
            
            // Reset all displayed values
            document.getElementById('total-staked').textContent = '0';
            document.getElementById('your-stake').textContent = '0';
            document.getElementById('your-rewards').textContent = '0';
            document.getElementById('treasury-balance').textContent = '0';
            document.getElementById('staking-reward-rate').textContent = '0';
            document.getElementById('burn-reward-rate').textContent = '0';
            document.getElementById('lbr-balance').textContent = '0';
            document.getElementById('total-supply').textContent = '0';
            document.getElementById('burned-today').textContent = '0';
        }
        
        // Update wallet UI
        function updateWalletUI() {
            if (userAddress) {
                connectWalletBtn.classList.add('d-none');
                walletConnectedDiv.classList.remove('d-none');
                walletAddressSpan.textContent = `${userAddress.substring(0, 6)}...${userAddress.substring(38)}`;
            } else {
                connectWalletBtn.classList.remove('d-none');
                walletConnectedDiv.classList.add('d-none');
            }
        }

		// Helper untuk format angka jadi 8 desimal
		function formatFixed(value, decimals = 18, precision = 8) {
			return Number(formatUnits(value, decimals)).toFixed(precision);
		}

		async function updateStats() {
			if (!userAddress) return;

			try {
				// Total Staked
				const totalStaked = await lbrStakingContract.methods.totalStaked().call();
				document.getElementById('total-staked').textContent = formatFixed(totalStaked);

				// Your Stake
				const yourStake = await lbrStakingContract.methods.stakes(userAddress).call();
				document.getElementById('your-stake').textContent = formatFixed(yourStake.amount);

				// Your Rewards
				const yourRewards = await lbrStakingContract.methods.earned(userAddress).call();
				document.getElementById('your-rewards').textContent = formatFixed(yourRewards);

				// Treasury Balance
                const treasuryBalance = await lbrStakingContract.methods.getTreasuryLBRBalance().call();
                const formattedTreasury = Number(formatUnits(treasuryBalance, 18)).toFixed(3);
                document.getElementById('treasury-balance').textContent = formattedTreasury;

				// Staking Reward Rate
				document.getElementById('staking-reward-rate').textContent = "150 LBR/1 lbrETH/day";

				// Burn Reward Rate
				const burnRewardRate = await lbrStakingContract.methods.burnRewardRate().call();
				const burnRewardRatio = (burnRewardRate / 10000).toFixed(4);
				document.getElementById('burn-reward-rate').textContent = `${burnRewardRatio}x`;

				// LBR Balance
				const lbrBalance = await lbrTokenContract.methods.balanceOf(userAddress).call();
				document.getElementById('lbr-balance').textContent = formatFixed(lbrBalance);

				// Total Supply
				const totalSupply = await lbrTokenContract.methods.totalSupply().call();
				const formattedSupply = Number(formatUnits(totalSupply, 18)).toFixed(3);
                document.getElementById('total-supply').textContent = formattedSupply;
                
                const burnedToday = await lbrTreasuryContract.methods.burnedToday().call();
                const formattedBurnedToday = Number(formatUnits(burnedToday, 18)).toFixed(3);
                document.getElementById('burned-today').textContent = formattedBurnedToday;

				// Update active locks
				updateActiveLocks();
			} catch (error) {
				console.error("Error updating stats:", error);
			}
		}

        async function updateActiveLocks() {
        	if (!userAddress) return;
        
        	try {
        		const locks = await lbrStakingContract.methods.getUserLocks(userAddress).call();
        		const locksList = document.getElementById('locks-list');
        
        		if (locks.length === 0) {
        			locksList.innerHTML = '<p class="text-muted">No active locks found</p>';
        			return;
        		}
        
        		locksList.innerHTML = '';
        
        		locks.forEach((lock, index) => {
        			if (!lock.claimed) {
        				const lockDiv = document.createElement('div');
        				lockDiv.className = 'glass-card p-3 mb-2';
        
        				// Convert unlock time to readable date
        				const unlockDate = new Date(lock.unlockTime * 1000).toLocaleDateString();
        
        				// Convert amount from wei to human-readable (assumes 18 decimals)
        				const lockAmount = ethers.utils.formatUnits(lock.amount, 18);
        
        				// Convert APY from 1000 = 10.00%
        				const displayAPY = (parseFloat(lock.apy) / 100).toFixed(2);
        
        				lockDiv.innerHTML = `
        					<div class="d-flex justify-content-between align-items-center mb-2">
        						<span>Lock #${index + 1}</span>
        						<span class="badge bg-primary">APY: ${displayAPY}%</span>
        					</div>
        					<div class="d-flex justify-content-between align-items-center mb-2">
        						<small>Amount: ${lockAmount} LBR</small>
        						<small>Unlocks: ${unlockDate}</small>
        					</div>
        					<button class="btn btn-sm btn-outline-primary w-100 unlock-btn" data-lock-id="${index}">
        						Unlock
        					</button>
        				`;
        
        				locksList.appendChild(lockDiv);
        			}
        		});
        
        		// Add event listeners to unlock buttons
        		document.querySelectorAll('.unlock-btn').forEach(button => {
        			button.addEventListener('click', function () {
        				const lockId = this.getAttribute('data-lock-id');
        				unlockReward(lockId);
        			});
        		});
        	} catch (error) {
        		console.error("Error updating active locks:", error);
        	}
        }


        
        // Set max deposit amount
        async function setMaxDeposit() {
            if (!userAddress) {
                alert("Please connect your wallet first");
                return;
            }
            
            try {
                const balance = await web3.eth.getBalance(userAddress);
                document.getElementById('deposit-amount').value = formatUnits(balance, 18);
            } catch (error) {
                console.error("Error getting ETH balance:", error);
            }
        }
        
        // Set max withdraw amount
        async function setMaxWithdraw() {
            if (!userAddress) {
                alert("Please connect your wallet first");
                return;
            }
            
            try {
                const balance = await lbrETHContract.methods.balanceOf(userAddress).call();
                document.getElementById('withdraw-amount').value = formatUnits(balance, 18);
            } catch (error) {
                console.error("Error getting lbrETH balance:", error);
            }
        }
        
        // Set max stake amount
        async function setMaxStake() {
            if (!userAddress) {
                alert("Please connect your wallet first");
                return;
            }
            
            try {
                const balance = await lbrETHContract.methods.balanceOf(userAddress).call();
                document.getElementById('stake-amount').value = formatUnits(balance, 18);
            } catch (error) {
                console.error("Error getting lbrETH balance:", error);
            }
        }
        
        // Set max burn amount
        async function setMaxBurn() {
            if (!userAddress) {
                alert("Please connect your wallet first");
                return;
            }
            
            try {
                const balance = await lbrTokenContract.methods.balanceOf(userAddress).call();
                document.getElementById('burn-amount').value = formatUnits(balance, 18);
            } catch (error) {
                console.error("Error getting LBR balance:", error);
            }
        }
        
        // Set max lock amount
        async function setMaxLock() {
            if (!userAddress) {
                alert("Please connect your wallet first");
                return;
            }
            
            try {
                const balance = await lbrTokenContract.methods.balanceOf(userAddress).call();
                document.getElementById('lock-amount').value = formatUnits(balance, 18);
            } catch (error) {
                console.error("Error getting LBR balance:", error);
            }
        }
        
        // Deposit ETH to lbrETH
        async function depositETH() {
            if (!userAddress) {
                alert("Please connect your wallet first");
                return;
            }
            
            const amount = document.getElementById('deposit-amount').value;
            if (!amount || parseFloat(amount) <= 0) {
                alert("Please enter a valid amount");
                return;
            }
            
            const amountWei = parseUnits(amount, 18);
            
            try {
                showTransactionModal("Depositing ETH to lbrETH...");
                
                const tx = await lbrETHContract.methods.deposit().send({
                    from: userAddress,
                    value: amountWei.toString()
                });
                
                showTransactionSuccess(tx.transactionHash);
                updateStats();
            } catch (error) {
                showTransactionError(error.message);
                console.error("Error depositing ETH:", error);
            }
        }
        
        // Withdraw lbrETH to ETH
        async function withdrawLbrETH() {
            if (!userAddress) {
                alert("Please connect your wallet first");
                return;
            }
            
            const amount = document.getElementById('withdraw-amount').value;
            if (!amount || parseFloat(amount) <= 0) {
                alert("Please enter a valid amount");
                return;
            }
            
            const amountWei = parseUnits(amount, 18);
            
            try {
                showTransactionModal("Withdrawing lbrETH to ETH...");
                
                const tx = await lbrETHContract.methods.withdraw(amountWei.toString()).send({
                    from: userAddress
                });
                
                showTransactionSuccess(tx.transactionHash);
                updateStats();
            } catch (error) {
                showTransactionError(error.message);
                console.error("Error withdrawing lbrETH:", error);
            }
        }
        
        // Approve lbrETH for staking
        async function approveStake() {
            if (!userAddress) {
                alert("Please connect your wallet first");
                return;
            }
        
            const amount = document.getElementById('stake-amount').value; // Ambil jumlah token dari input user
            if (!amount || parseFloat(amount) <= 0) {
                alert("Please enter a valid amount");
                return;
            }
        
            try {
                showTransactionModal("Approving lbrETH for staking...");
        
                // Convert jumlah yang diinput ke Wei (18 decimal)
                const amountWei = ethers.utils.parseUnits(amount, 18);
        
                // Approve sesuai dengan jumlah yang diinput
                const tx = await lbrETHContract.methods.approve(
                    lbrStakingAddress,
                    amountWei
                ).send({
                    from: userAddress
                });
        
                showTransactionSuccess(tx.transactionHash);
            } catch (error) {
                showTransactionError(error.message);
                console.error("Error approving lbrETH:", error);
            }
        }

        
        // Stake lbrETH
        async function stakeLbrETH() {
            if (!userAddress) {
                alert("Please connect your wallet first");
                return;
            }
            
            const amount = document.getElementById('stake-amount').value;
            if (!amount || parseFloat(amount) <= 0) {
                alert("Please enter a valid amount");
                return;
            }
            
            const amountWei = parseUnits(amount, 18);
            
            try {
                // Check allowance first
                const allowance = await lbrETHContract.methods.allowance(userAddress, lbrStakingAddress).call();
                
                if (BigInt(allowance) < BigInt(amountWei.toString())) {
                    alert("Please approve lbrETH for staking first");
                    return;
                }
                
                showTransactionModal("Staking lbrETH...");
                
                const tx = await lbrStakingContract.methods.stake(amountWei.toString()).send({
                    from: userAddress
                });
                
                showTransactionSuccess(tx.transactionHash);
                updateStats();
            } catch (error) {
                showTransactionError(error.message);
                console.error("Error staking lbrETH:", error);
            }
        }
        
        // Unstake lbrETH
        async function unstakeLbrETH() {
            if (!userAddress) {
                alert("Please connect your wallet first");
                return;
            }
            
            const amount = document.getElementById('stake-amount').value;
            if (!amount || parseFloat(amount) <= 0) {
                alert("Please enter a valid amount");
                return;
            }
            
            const amountWei = parseUnits(amount, 18);
            
            try {
                showTransactionModal("Unstaking lbrETH...");
                
                const tx = await lbrStakingContract.methods.unstake(amountWei.toString()).send({
                    from: userAddress
                });
                
                showTransactionSuccess(tx.transactionHash);
                updateStats();
            } catch (error) {
                showTransactionError(error.message);
                console.error("Error unstaking lbrETH:", error);
            }
        }
        
        // Claim rewards
        async function claimRewards() {
            if (!userAddress) {
                alert("Please connect your wallet first");
                return;
            }
            
            try {
                showTransactionModal("Claiming rewards...");
                
                const tx = await lbrStakingContract.methods.claimReward().send({
                    from: userAddress
                });
                
                showTransactionSuccess(tx.transactionHash);
                updateStats();
            } catch (error) {
                showTransactionError(error.message);
                console.error("Error claiming rewards:", error);
            }
        }
        
        async function approveBurn() {
            if (!userAddress) {
                alert("Please connect your wallet first");
                return;
            }
            
            try {
                showTransactionModal("Approving LBR for burning...");
                
                const tx = await lbrTokenContract.methods.approve(
                    lbrStakingAddress,
                    ethers.constants.MaxUint256
                ).send({
                    from: userAddress
                });
                
                showTransactionSuccess(tx.transactionHash);
            } catch (error) {
                showTransactionError(error.message);
                console.error("Error approving LBR:", error);
            }
        }

        
        // Burn LBR for reward
        async function burnForReward() {
            if (!userAddress) {
                alert("Please connect your wallet first");
                return;
            }
            
            const amount = document.getElementById('burn-amount').value;
            if (!amount || parseFloat(amount) <= 0) {
                alert("Please enter a valid amount");
                return;
            }
            
            const amountWei = parseUnits(amount, 18);
            
            try {
                // Check allowance first
                const allowance = await lbrTokenContract.methods.allowance(userAddress, lbrStakingAddress).call();
                
                if (BigInt(allowance) < BigInt(amountWei.toString())) {
                    alert("Please approve LBR for burning first");
                    return;
                }
                
                showTransactionModal("Burning LBR for reward...");
                
                const tx = await lbrStakingContract.methods.burnForReward(amountWei.toString()).send({
                    from: userAddress
                });
                
                showTransactionSuccess(tx.transactionHash);
                updateStats();
            } catch (error) {
                showTransactionError(error.message);
                console.error("Error burning LBR:", error);
            }
        }
        
        async function approveLock() {
            if (!userAddress) {
                alert("Please connect your wallet first");
                return;
            }
        
            const amount = document.getElementById('lock-amount').value;
            if (!amount || parseFloat(amount) <= 0) {
                alert("Please enter a valid amount");
                return;
            }
        
            const amountWei = ethers.utils.parseUnits(amount, 18);  // Mengonversi jumlah LBR ke wei (18 desimal)
        
            try {
                showTransactionModal("Approving LBR for locking...");
                
                // Approve LBR untuk staking, gunakan jumlah token yang sesuai
                const tx = await lbrTokenContract.methods.approve(
                    lbrStakingAddress,
                    amountWei.toString()  // Hanya approve sejumlah amount yang sesuai
                ).send({
                    from: userAddress
                });
        
                showTransactionSuccess(tx.transactionHash);
            } catch (error) {
                showTransactionError(error.message);
                console.error("Error approving LBR:", error);
            }
        }
        
                
        async function lockReward() {
            if (!userAddress) {
                alert("Please connect your wallet first");
                return;
            }
            
            const amount = document.getElementById('lock-amount').value;
            if (!amount || parseFloat(amount) <= 0) {
                alert("Please enter a valid amount");
                return;
            }
            
            // Ambil durasi yang dipilih dari dropdown
            const durationInDays = document.getElementById('lock-duration').value;
            if (!durationInDays) {
                alert("Please select a duration");
                return;
            }
            
            // Konversi durasi dalam hari ke detik
            const durationInSeconds = durationInDays * 24 * 60 * 60;  // Mengonversi hari ke detik
            
            const amountWei = parseUnits(amount, 18);
            
            try {
                // Check allowance first
                const allowance = await lbrTokenContract.methods.allowance(userAddress, lbrStakingAddress).call();
                
                // Check if allowance is sufficient
                if (BigInt(allowance) < BigInt(amountWei.toString())) {
                    alert("Please approve LBR for locking first");
                    return;
                }
        
                showTransactionModal("Locking LBR for reward...");
                
                // Kirim transaksi dengan durasi yang sudah dikonversi ke detik
                const tx = await lbrStakingContract.methods.lockReward(
                    amountWei.toString(),
                    durationInSeconds // Durasi dalam detik
                ).send({
                    from: userAddress
                });
                
                showTransactionSuccess(tx.transactionHash);
                updateStats();
            } catch (error) {
                showTransactionError(error.message);
                console.error("Error locking LBR:", error);
            }
        }


        
        // Unlock reward
        async function unlockReward(lockId) {
            if (!userAddress) {
                alert("Please connect your wallet first");
                return;
            }
            
            try {
                showTransactionModal("Unlocking reward...");
                
                const tx = await lbrStakingContract.methods.unlock(lockId).send({
                    from: userAddress
                });
                
                showTransactionSuccess(tx.transactionHash);
                updateStats();
            } catch (error) {
                showTransactionError(error.message);
                console.error("Error unlocking reward:", error);
            }
        }
        
        // Helper function to format units
        function formatUnits(value, decimals) {
            return ethers.utils.formatUnits(value, decimals);
        }
        
        // Helper function to parse units
        function parseUnits(value, decimals) {
            return ethers.utils.parseUnits(value, decimals);
        }
        
        // Show transaction modal
        function showTransactionModal(message) {
            const modal = new bootstrap.Modal(document.getElementById('transactionModal'));
            document.getElementById('tx-message').textContent = message;
            document.getElementById('tx-loading').classList.remove('d-none');
            document.getElementById('tx-success').classList.add('d-none');
            document.getElementById('tx-error').classList.add('d-none');
            modal.show();
        }
        
        // Show transaction success
        function showTransactionSuccess(txHash) {
            document.getElementById('tx-loading').classList.add('d-none');
            document.getElementById('tx-success').classList.remove('d-none');
            document.getElementById('tx-explorer-link').href = `https://explorer.testnet.riselabs.xyz/tx/${txHash}`;
        }
        
        // Show transaction error
        function showTransactionError(message) {
            document.getElementById('tx-loading').classList.add('d-none');
            document.getElementById('tx-error').classList.remove('d-none');
            document.getElementById('tx-error-message').textContent = message;
        }
    </script>
</body>
</html>
